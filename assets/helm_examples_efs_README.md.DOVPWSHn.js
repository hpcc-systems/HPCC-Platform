import{_ as i,a,o as e,ag as t}from"./chunks/framework.Do1Zayaf.js";const o=JSON.parse('{"title":"HPCC Elastic File System (EFS) Storage","description":"","frontmatter":{},"headers":[],"relativePath":"helm/examples/efs/README.md","filePath":"helm/examples/efs/README.md","lastUpdated":1771585025000}'),h={name:"helm/examples/efs/README.md"};function n(l,s,p,k,r,F){return e(),a("div",null,s[0]||(s[0]=[t(`<h1 id="hpcc-elastic-file-system-efs-storage" tabindex="-1">HPCC Elastic File System (EFS) Storage <a class="header-anchor" href="#hpcc-elastic-file-system-efs-storage" aria-label="Permalink to &quot;HPCC Elastic File System (EFS) Storage&quot;">​</a></h1><h1 id="efs-csi-driver" tabindex="-1">EFS CSI Driver <a class="header-anchor" href="#efs-csi-driver" aria-label="Permalink to &quot;EFS CSI Driver&quot;">​</a></h1><p>&quot;examples/efs&quot; requires Elastic FileSystem (EFS) Container Storage Interface (CSI) driver. We provide some scripts to simplify the process. For details please reference <a href="https://docs.aws.amazon.com/eks/latest/userguide/efs-csi.html" target="_blank" rel="noreferrer">https://docs.aws.amazon.com/eks/latest/userguide/efs-csi.html</a> Current implementation only tested successfully with a IAM user. It may need updates for Active Directory Federation Service (ADFS)</p><h2 id="prepare-environment" tabindex="-1">Prepare environment <a class="header-anchor" href="#prepare-environment" aria-label="Permalink to &quot;Prepare environment&quot;">​</a></h2><p>Make sure an EFS file system is available or create an <a href="#efs-file-system">EFS File System</a> before using this chart.<br> Fill in the following information in the efs-env file</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>ACCOUNT_ID       # AWS Account ID</span></span>
<span class="line"><span>EKS_NAME         # Elastic Kubernetes Service (EKS) cluster name: kubectl configure get-cluster  (The first part of the name before &quot;.&quot;)</span></span>
<span class="line"><span>EFS_ID           # EFS ID can be found from AWS Console or command-line:</span></span>
<span class="line"><span>                   aws efs describe-file-systems --query &quot;FileSystems[*].FileSystemId&quot; --output text</span></span>
<span class="line"><span>EFS_REGION       # EFS region. We strongly suggest you have the same region for EFS server and EKS cluster</span></span>
<span class="line"><span>EFS_SECURITY_GROUPS  # EFS security group which should be the same as the EKS cluster security group. Also, make sure the security group for the mount targets is the same as this one.</span></span>
<span class="line"><span>EFS_BASE_PATH    # Base directory to mount in the EFS. If you use EFS for multiple HPCC clusters you should set this differently to avoid clashing with the other clusters</span></span>
<span class="line"><span>VPC_ID           # The same VPC ID as the VPC of the EKS cluster</span></span></code></pre></div><h3 id="get-the-efs-id" tabindex="-1">Get the EFS ID <a class="header-anchor" href="#get-the-efs-id" aria-label="Permalink to &quot;Get the EFS ID&quot;">​</a></h3><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  aws</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> efs</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> describe-file-systems</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --region</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">REGIO</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">N</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span></span></code></pre></div><p>The output shows &quot;NAME&quot; and FileSystemID</p><h3 id="how-to-get-efs-security-groups" tabindex="-1">How to get EFS security groups <a class="header-anchor" href="#how-to-get-efs-security-groups" aria-label="Permalink to &quot;How to get EFS security groups&quot;">​</a></h3><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  aws</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> efs</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> describe-mount-targets</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --file-system-id</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">EFS</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> I</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">D</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --region</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">EFS</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> regio</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">n</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  awk</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -F</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> $&#39;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\t</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;{print $7}&#39;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # For each file-system mount target:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  aws</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> efs</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> describe-mount-targets-security-groups</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --mount-target-id</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">mount</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> target</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> i</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">d</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  --region</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">EFS</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> regio</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">n</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  awk</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -F</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> $&#39;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\t</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;{print $2}&#39;</span></span></code></pre></div><p>Add each unique security group id to the variable &quot;EFS_SECURITY_GROUPS&quot;</p><h2 id="install-efs-csi-driver" tabindex="-1">Install EFS CSI Driver <a class="header-anchor" href="#install-efs-csi-driver" aria-label="Permalink to &quot;Install EFS CSI Driver&quot;">​</a></h2><p>Run the following command under the efs directory:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">./install-efs-csi-driver.sh</span></span></code></pre></div><p>The script configures the IAM roles and policies, installs the aws-efs-csi-driver, and creates the file for the &quot;aws-efs-auto&quot; storage class. To verify</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">helm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> list</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kube-system</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">NAME</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                    NAMESPACE</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">       REVISION</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        UPDATED</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                                 STATUS</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">          CHART</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                           APP</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> VERSION</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">aws-efs-csi-driver</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      kube-system</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">     1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">               2022-08-19</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 17:25:53.6078326</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -0400</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> EDT</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   deployed</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        aws-efs-csi-driver-2.2.7</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        1.4.0</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> get</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> pod</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kube-system</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> grep</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> efs-csi</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">efs-csi-controller-594c7f67c7-8zk72</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   3/3</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">     Running</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   0</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">          32h</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">efs-csi-controller-594c7f67c7-mncgd</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   3/3</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">     Running</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   0</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">          32h</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">efs-csi-node-8g8fk</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                    3/3</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">     Running</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   0</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">          32h</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">efs-csi-node-fp8vt</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                    3/3</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">     Running</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   0</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">          32h</span></span></code></pre></div><h1 id="storage-for-hpcc-cluster" tabindex="-1">Storage for HPCC cluster <a class="header-anchor" href="#storage-for-hpcc-cluster" aria-label="Permalink to &quot;Storage for HPCC cluster&quot;">​</a></h1><p>There are three available storage life cycles/methods for the HPCC cluster.</p><h2 id="_1-dynamic-storage-with-values-auto-efs-yaml" tabindex="-1">1. Dynamic storage with values-auto-efs.yaml <a class="header-anchor" href="#_1-dynamic-storage-with-values-auto-efs-yaml" aria-label="Permalink to &quot;1. Dynamic storage with values-auto-efs.yaml&quot;">​</a></h2><p>This method uses the storage class &quot;aws-efs-auto&quot; to dynamically create Persistent Volume Claims (PVC). The PVCs are deleted when the HPCC cluster is deleted, meaning that the storage is deleted when the HPCC cluster is deleted. The storage can&#39;t be reused between different HPCC clusters.<br></p><p>Under the efs directory, run the following command to create the &quot;aws-efs-auto&quot; storage class</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> apply</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> storageclass.yaml</span></span></code></pre></div><p>To verify</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> get</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> sc</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">NAME</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">            PROVISIONER</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">             RECLAIMPOLICY</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   VOLUMEBINDINGMODE</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      ALLOWVOLUMEEXPANSION</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   AGE</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">aws-efs-auto</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    efs.csi.aws.com</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">         Delete</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">          Immediate</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">              false</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                  9s</span></span></code></pre></div><p>To deploy the HPCC cluster, navigate to the helm directory and run:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  helm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> myhpcc</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ./hpcc</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> global.image.version=latest</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> examples/efs/values-auto-efs.yaml</span></span></code></pre></div><p>To cleanup, run</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  helm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> uninstall</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> myhpcc</span></span></code></pre></div><h2 id="_2-static-storage-within-kubernetes-with-values-retained-efs-yaml" tabindex="-1">2. Static storage within Kubernetes with values-retained-efs.yaml <a class="header-anchor" href="#_2-static-storage-within-kubernetes-with-values-retained-efs-yaml" aria-label="Permalink to &quot;2. Static storage within Kubernetes with values-retained-efs.yaml&quot;">​</a></h2><p>In this method, storage lives on the Kubernetes cluster level. It uses the helm chart &quot;hpcc-efs-dynamic-pv&quot; to manually create PVCs. The PVs are dynamically generated. The PVCs will persist after the HPCC cluster is deleted, meaning that the storage can be reused across different HPCC clusters.<br> This method also uses the &quot;aws-efs-auto&quot; storage class. Under the efs directory, run the following command:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> apply</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> storageclass.yaml</span></span></code></pre></div><p>The storage needs to be created before starting the HPCC cluster. Under the helm directory, run the following command:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  helm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> awsstorage</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> examples/efs/hpcc-efs-dynamic-pv</span></span></code></pre></div><p>To verify</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> get</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> pvc</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">NAME</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                                 STATUS</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   VOLUME</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                                     CAPACITY</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   ACCESS</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> MODES</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   STORAGECLASS</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   AGE</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">dali-awsstorage-hpcc-efs-pvc</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">         Bound</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    pvc-400ddbb7-1b89-4468-b416-ffece25aab0d</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   1Gi</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        RWO</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">            aws-efs</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        5m52s</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">data-awsstorage-hpcc-efs-pvc</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">         Bound</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    pvc-0b99092e-56ba-4c2e-8572-9a5ab4d4da4b</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   3Gi</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        RWX</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">            aws-efs</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        5m52s</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">dll-awsstorage-hpcc-efs-pvc</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">          Bound</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    pvc-70a470ec-b754-4376-9afb-f1bd499c51ec</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   1Gi</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        RWX</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">            aws-efs</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        5m52s</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">mydropzone-awsstorage-hpcc-efs-pvc</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   Bound</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    pvc-9ecd2abc-7713-4639-8da2-91392e636e19</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   1Gi</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        RWX</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">            aws-efs</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        5m52s</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sasha-awsstorage-hpcc-efs-pvc</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        Bound</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    pvc-30c3357c-d982-47f9-ac2c-c1465639b10e</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   1Gi</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        RWX</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">            aws-efs</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        5m52s</span></span></code></pre></div><p>To start the HPCC cluster, run</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>  helm install myhpcc ./hpcc --set global.image.version=latest -f examples/efs/values-retained-efs.yaml</span></span></code></pre></div><p>An example values file to be supplied when installing the HPCC chart. NB: Either use the output auto-generated when installing the &quot;hpcc-efs&quot; helm chart, or ensure the names in your values files for the storage types match the PVC names created. The &quot;values-retained-efs.yaml&quot; file expects that helm chart installation name is &quot;awsstorage&quot;. Change the PVC name accordingly if another name is used.<br> To cleanup, run</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  helm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> uninstall</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> myhpcc</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  helm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> uninstall</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> awsstorage</span></span></code></pre></div><h2 id="_3-static-storage-beyond-kubernetes-with-values-retained-efs-yaml" tabindex="-1">3. Static storage beyond Kubernetes with values-retained-efs.yaml <a class="header-anchor" href="#_3-static-storage-beyond-kubernetes-with-values-retained-efs-yaml" aria-label="Permalink to &quot;3. Static storage beyond Kubernetes with values-retained-efs.yaml&quot;">​</a></h2><p>In this method, the storage lives beyond the Kubernetes cluster. It uses the helm chart &quot;hpcc-efs-static-pv&quot; to manually create PVs and PVCs and to configure access points in EFS with the Kubernetes cluster. This means that even if the Kubernetes cluster is deleted, the storage will remain and can be reused across different Kubernetes clusters.<br> The create-ap.sh script creates five access points in EFS for each of dali, dll, sasha, data, and mydropzone. It also displays a description for each access point. You may need to add additional tags to the access points depending on your organization. For example, for RISK users, the &quot;owner&quot; and &quot;owner_email&quot; tags are required; add these to the script as needed.<br> Once you are ready, under the efs directory run the following command:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">./create-ap.sh</span></span></code></pre></div><p>Note that running the script again will create five more access points with the same exact specifications. Use the delete-ap.sh to delete all access points.<br> Navigate to hpcc-efs-static-pv -&gt; values.yaml. Paste the EFS ID where it says &quot;efsID&quot; and the access point IDs where it says &quot;apID&quot;. You can get the access point IDs either through the console or from the descriptions after running the create-ap.sh script. Make sure the correct access point IDs correspond to the correct names in the values.yaml.<br></p><p>The storage needs to be created before starting the HPCC cluster. Under the helm directory, run the following command:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  helm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> awsstorage</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> examples/efs/hpcc-efs-static-pv</span></span></code></pre></div><p>To verify</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> get</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> sc</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">NAME</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">             PROVISIONER</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">             RECLAIMPOLICY</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   VOLUMEBINDINGMODE</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      ALLOWVOLUMEEXPANSION</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   AGE</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">aws-efs-static</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   efs.csi.aws.com</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">         Delete</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">          Immediate</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">              false</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                  110s</span></span></code></pre></div><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> get</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> pv</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">NAME</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                                CAPACITY</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   ACCESS</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> MODES</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   RECLAIM</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> POLICY</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   STATUS</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   CLAIM</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                                        STORAGECLASS</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">     REASON</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   AGE</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">dali-awsstorage-hpcc-efs-pv</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">         1Gi</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        RWO</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">            Retain</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">           Bound</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    default/dali-awsstorage-hpcc-efs-pvc</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">         aws-efs-static</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">            23s</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">data-awsstorage-hpcc-efs-pv</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">         3Gi</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        RWX</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">            Retain</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">           Bound</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    default/data-awsstorage-hpcc-efs-pvc</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">         aws-efs-static</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">            23s</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">dll-awsstorage-hpcc-efs-pv</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">          1Gi</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        RWX</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">            Retain</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">           Bound</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    default/dll-awsstorage-hpcc-efs-pvc</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">          aws-efs-static</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">            23s</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">mydropzone-awsstorage-hpcc-efs-pv</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   1Gi</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        RWX</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">            Retain</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">           Bound</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    default/mydropzone-awsstorage-hpcc-efs-pvc</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   aws-efs-static</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">            23s</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sasha-awsstorage-hpcc-efs-pv</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        1Gi</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        RWX</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">            Retain</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">           Bound</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    default/sasha-awsstorage-hpcc-efs-pvc</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        aws-efs-static</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">            23s</span></span></code></pre></div><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> get</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> pvc</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">NAME</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                                 STATUS</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   VOLUME</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                              CAPACITY</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   ACCESS</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> MODES</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   STORAGECLASS</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">     AGE</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">dali-awsstorage-hpcc-efs-pvc</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">         Bound</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    dali-awsstorage-hpcc-efs-pv</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">         1Gi</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        RWO</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">            aws-efs-static</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   29s</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">data-awsstorage-hpcc-efs-pvc</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">         Bound</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    data-awsstorage-hpcc-efs-pv</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">         3Gi</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        RWX</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">            aws-efs-static</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   29s</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">dll-awsstorage-hpcc-efs-pvc</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">          Bound</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    dll-awsstorage-hpcc-efs-pv</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">          1Gi</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        RWX</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">            aws-efs-static</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   29s</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">mydropzone-awsstorage-hpcc-efs-pvc</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   Bound</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    mydropzone-awsstorage-hpcc-efs-pv</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   1Gi</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        RWX</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">            aws-efs-static</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   29s</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sasha-awsstorage-hpcc-efs-pvc</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        Bound</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    sasha-awsstorage-hpcc-efs-pv</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        1Gi</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        RWX</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">            aws-efs-static</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   29s</span></span></code></pre></div><p>To start the HPCC cluster, run</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>  helm install myhpcc ./hpcc --set global.image.version=latest -f examples/efs/values-retained-efs.yaml</span></span></code></pre></div><p>To cleanup, run</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  helm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> uninstall</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> myhpcc</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  helm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> uninstall</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> awsstorage</span></span></code></pre></div><h1 id="efs-file-system" tabindex="-1">EFS File System <a class="header-anchor" href="#efs-file-system" aria-label="Permalink to &quot;EFS File System&quot;">​</a></h1><p>Reference:</p><ul><li><a href="https://docs.aws.amazon.com/efs/latest/ug/gs-step-two-create-efs-resources.html" target="_blank" rel="noreferrer">https://docs.aws.amazon.com/efs/latest/ug/gs-step-two-create-efs-resources.html</a></li><li><a href="https://hpccsystems.com/resources/setting-up-an-hpcc-systems-cluster-on-aws-eks/" target="_blank" rel="noreferrer">https://hpccsystems.com/resources/setting-up-an-hpcc-systems-cluster-on-aws-eks/</a> You can use either AWS CLI or the console to create the EFS.</li></ul><h2 id="aws-cli" tabindex="-1">AWS CLI <a class="header-anchor" href="#aws-cli" aria-label="Permalink to &quot;AWS CLI&quot;">​</a></h2><p>If you don&#39;t have AWS CLI reference</p><ul><li><a href="https://docs.aws.amazon.com/cli/latest/userguide/cli-chap-install.html" target="_blank" rel="noreferrer">https://docs.aws.amazon.com/cli/latest/userguide/cli-chap-install.html</a></li></ul><p>For simple setup we recommend you use the same VPC/Subnets and security group for both EFS and EKS</p><h3 id="create-efs-server" tabindex="-1">Create EFS Server <a class="header-anchor" href="#create-efs-server" aria-label="Permalink to &quot;Create EFS Server&quot;">​</a></h3><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  aws</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> efs</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> create-file-system</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --throughput-mode</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> bursting</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --tags</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;Key=Name,Value=&lt;EFS Name&gt;&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --region</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">REGIO</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">N</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span></span></code></pre></div><p>The EFS server FQDN will be</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  &lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">EFS</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> I</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">D</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">.efs.</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">REGIO</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">N</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">.amazonaws.com</span></span></code></pre></div><h3 id="creating-the-mount-targets" tabindex="-1">Creating the Mount Targets <a class="header-anchor" href="#creating-the-mount-targets" aria-label="Permalink to &quot;Creating the Mount Targets&quot;">​</a></h3><p>Pick a VPC in the the same region of EFS server</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  aws</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ec2</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> describe-vpcs</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --region</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">REGIO</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">N</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span></span></code></pre></div><p>The output shows the VPC IDs. Get all the subnets of the VPC</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  aws</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ec2</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> describe-subnets</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --region</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">REGIO</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">N</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --fileters</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;Name=vpc-id,Values=&lt;VPC ID&gt;&quot;</span></span></code></pre></div><p>The output shows &quot;AvailabilityZone&quot; and &quot;Subnets ID&quot;<br> We recommend you use these all or subets of these &quot;AvailabalityZone&quot; and &quot;Subnet IDs&quot; to create EKS cluster with the option &quot;--managed&quot;. It will be easier to configure EFS and EKS.</p><p>To create the mount target:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  aws</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> efs</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> create-mount-target</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --region</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">REGIO</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">N</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --file-system-id</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">EFS</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> I</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">D</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --subnet-id</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Subnet</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> i</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">d</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span></span></code></pre></div><p>Repeat this for all subnets. Usually an AWS EKS cluster needs at least two available zones (subnets). If you are not sure, create mount targets for all zones.</p><p>To display the mount targets:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  aws</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> efs</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> describe-mount-targets</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --region</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">REGIO</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">N</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --file-system-id</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">EFS</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> I</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">D</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span></span></code></pre></div><h2 id="console" tabindex="-1">Console <a class="header-anchor" href="#console" aria-label="Permalink to &quot;Console&quot;">​</a></h2><h3 id="create-efs-server-1" tabindex="-1">Create EFS Server <a class="header-anchor" href="#create-efs-server-1" aria-label="Permalink to &quot;Create EFS Server&quot;">​</a></h3><p>Navigate to the EFS service and click &quot;Create file system&quot;. Select the same VPC as the one your EKS cluster is running in.</p><h3 id="configuring-the-mount-targets" tabindex="-1">Configuring the Mount Targets <a class="header-anchor" href="#configuring-the-mount-targets" aria-label="Permalink to &quot;Configuring the Mount Targets&quot;">​</a></h3><p>Click on the file system you just created and navigate to &quot;Network&quot;. Your mount targets should be displayed.<br> Click on &quot;Manage&quot;, and you should see that the security groups for the mount targets are the default security group. Replace these with the EKS cluster security group. To find the EKS cluster security group navigate to EKS. Click on your cluster. Click on &quot;Networking&quot;, and find the security group displayed under &quot;Cluster security group&quot;. After replacing the default security group for all mount targets, save your changes.</p>`,81)]))}const g=i(h,[["render",n]]);export{o as __pageData,g as default};

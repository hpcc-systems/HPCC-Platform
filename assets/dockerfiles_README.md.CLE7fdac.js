import{_ as e,a as i,o as a,ag as l}from"./chunks/framework.Do1Zayaf.js";const k=JSON.parse('{"title":"Docker tooling for HPCC Platform","description":"","frontmatter":{},"headers":[],"relativePath":"dockerfiles/README.md","filePath":"dockerfiles/README.md","lastUpdated":1771585025000}'),n={name:"dockerfiles/README.md"};function t(o,s,r,d,c,h){return a(),i("div",null,s[0]||(s[0]=[l(`<h1 id="docker-tooling-for-hpcc-platform" tabindex="-1">Docker tooling for HPCC Platform <a class="header-anchor" href="#docker-tooling-for-hpcc-platform" aria-label="Permalink to &quot;Docker tooling for HPCC Platform&quot;">​</a></h1><p>This folder contains Dockerfiles and helper scripts used for:</p><ul><li>building HPCC Platform in containerized build environments (multiple OS targets)</li><li>producing a runnable <code>platform-core</code> image from your current working tree (debug/release)</li><li>spinning up a local Kubernetes deployment using the repo Helm charts</li></ul><h2 id="prerequisites" tabindex="-1">Prerequisites <a class="header-anchor" href="#prerequisites" aria-label="Permalink to &quot;Prerequisites&quot;">​</a></h2><ul><li>Docker (BuildKit enabled). Some workflows use <code>docker buildx</code>.</li><li>For <code>startall.sh</code> / <code>stopall.sh</code>: <code>helm</code>, <code>kubectl</code>, and access to a Kubernetes cluster.</li><li>Optional: a <code>.env</code> file at the repo root with <code>DOCKER_USERNAME</code> / <code>DOCKER_PASSWORD</code> (used by <code>build.sh</code> for <code>docker login</code>).</li></ul><h2 id="common-workflows" tabindex="-1">Common workflows <a class="header-anchor" href="#common-workflows" aria-label="Permalink to &quot;Common workflows&quot;">​</a></h2><h3 id="build-a-local-platform-core-image-from-this-working-tree" tabindex="-1">Build a local <code>platform-core</code> image from this working tree <a class="header-anchor" href="#build-a-local-platform-core-image-from-this-working-tree" aria-label="Permalink to &quot;Build a local \`platform-core\` image from this working tree&quot;">​</a></h3><p>This is the main developer workflow.</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">cd</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> dockerfiles</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Debug build + install into an image</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">./image.sh</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> build</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -m</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> debug</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Release build + package (.deb) + install into an image</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">./image.sh</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> build</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -m</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> release</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Faster incremental debug build (equivalent to build -m debug)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">./image.sh</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> incr</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Re-run CMake configure step</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">./image.sh</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> build</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -m</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> debug</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -r</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Keep separate build volumes per git branch</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">./image.sh</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> build</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -m</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> debug</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -t</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Select the build OS image (default is ubuntu-22.04)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">BUILD_OS</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">ubuntu-24.04</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ./image.sh</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> build</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -m</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> debug</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Override architecture detection</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">./image.sh</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> build</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -a</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> arm64</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -m</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> debug</span></span></code></pre></div><p>Notes:</p><ul><li><code>image.sh</code> uses Docker volumes to cache sources and build artifacts.</li><li>The final image is tagged as <code>hpccsystems/platform-core:&lt;branch&gt;-&lt;mode&gt;-&lt;crc&gt;</code> and also as <code>incr-core:&lt;mode&gt;</code>.</li><li>Run <code>./image.sh status</code> to see the resolved environment values.</li></ul><h3 id="create-an-image-from-a-local-artifact" tabindex="-1">Create an image from a local artifact <a class="header-anchor" href="#create-an-image-from-a-local-artifact" aria-label="Permalink to &quot;Create an image from a local artifact&quot;">​</a></h3><p>Use <code>install</code> to create an image from either a local <code>.deb</code> or a local build folder.</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">cd</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> dockerfiles</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># From a .deb</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">./image.sh</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /path/to/hpccsystems-platform-community_</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">*</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">.deb</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># From a build folder (must contain CMakeCache.txt)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">./image.sh</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /path/to/build/folder</span></span></code></pre></div><h3 id="build-containerized-cmake-builds-across-os-targets" tabindex="-1">Build containerized CMake builds across OS targets <a class="header-anchor" href="#build-containerized-cmake-builds-across-os-targets" aria-label="Permalink to &quot;Build containerized CMake builds across OS targets&quot;">​</a></h3><p><code>build.sh</code> builds an OS-specific container image and runs a CMake/Ninja build inside it.</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">cd</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> dockerfiles</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Run several builds in parallel (logs go to build/docker-logs/)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">./build.sh</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Single target</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">./build.sh</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ubuntu-22.04</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Override architecture</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">ARCH</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">arm64</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ./build.sh</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ubuntu-22.04</span></span></code></pre></div><p>Build output is written back into the repo under <code>build/&lt;target&gt;/</code>.</p><h3 id="deploy-to-a-local-kubernetes-cluster" tabindex="-1">Deploy to a local Kubernetes cluster <a class="header-anchor" href="#deploy-to-a-local-kubernetes-cluster" aria-label="Permalink to &quot;Deploy to a local Kubernetes cluster&quot;">​</a></h3><p><code>startall.sh</code> and <code>stopall.sh</code> use the Helm charts in <code>../helm/</code>.</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">cd</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> dockerfiles</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Start or upgrade an HPCC install (defaults to cluster name &quot;mycluster&quot;)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">./startall.sh</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> mycluster</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -l</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">image-ta</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">g</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Stop it</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">./stopall.sh</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> mycluster</span></span></code></pre></div><p>Run <code>./startall.sh -h</code> for supported flags (including optional Elastic/Prometheus/Loki deployments).</p><h2 id="dockerfiles-in-this-folder" tabindex="-1">Dockerfiles in this folder <a class="header-anchor" href="#dockerfiles-in-this-folder" aria-label="Permalink to &quot;Dockerfiles in this folder&quot;">​</a></h2><h3 id="build-environment-images" tabindex="-1">Build environment images <a class="header-anchor" href="#build-environment-images" aria-label="Permalink to &quot;Build environment images&quot;">​</a></h3><p>These <code>*.dockerfile</code> files create “build environment” images that are thin wrappers over prebuilt <code>hpccsystems/platform-build-base-&lt;os&gt;:&lt;vcpkg-ref&gt;</code> images.</p><ul><li><code>ubuntu-20.04.dockerfile</code>, <code>ubuntu-22.04.dockerfile</code>, <code>ubuntu-24.04.dockerfile</code></li><li><code>rockylinux-8.dockerfile</code></li><li><code>centos-7.dockerfile</code></li><li><code>wasm32-emscripten.dockerfile</code></li></ul><p>They’re used by <code>build.sh</code> and <code>image.sh</code>.</p><h3 id="runtime-base-images-platform-core" tabindex="-1">Runtime base images (<code>platform-core-*</code>) <a class="header-anchor" href="#runtime-base-images-platform-core" aria-label="Permalink to &quot;Runtime base images (\`platform-core-*\`)&quot;">​</a></h3><p>These Dockerfiles install runtime dependencies, create the <code>hpcc</code> user, and set up the container filesystem layout (but do not build HPCC on their own).</p><ul><li><code>platform-core-ubuntu-20.04.dockerfile</code></li><li><code>platform-core-ubuntu-22.04.dockerfile</code></li><li><code>platform-core-ubuntu-24.04.dockerfile</code></li><li><code>platform-core-debug-ubuntu-22.04.dockerfile</code> (adds <code>gdb</code> ptrace capability via <code>setcap</code>)</li></ul><p><code>image.sh</code> uses these as a base and then installs HPCC from your build output.</p><h3 id="build-from-deb-dockerfile" tabindex="-1">Build-from-deb Dockerfile <a class="header-anchor" href="#build-from-deb-dockerfile" aria-label="Permalink to &quot;Build-from-deb Dockerfile&quot;">​</a></h3><p><code>platform-core-ubuntu-22.04/Dockerfile</code> is a standalone Dockerfile that expects an HPCC <code>.deb</code> to be present in the Docker build context (see <code>PKG_FILE</code> in that Dockerfile). It can be useful for CI or manual builds where you already have a packaged <code>.deb</code> and want a simple <code>docker build</code>.</p><h2 id="helper-scripts" tabindex="-1">Helper scripts <a class="header-anchor" href="#helper-scripts" aria-label="Permalink to &quot;Helper scripts&quot;">​</a></h2><ul><li><code>image.sh</code>: build/install HPCC into a <code>platform-core</code> image from the current repo checkout.</li><li><code>build.sh</code>: run builds in OS-specific build containers; can build multiple targets in parallel.</li><li><code>cleanup.sh</code>: remove dangling images and older <code>hpccsystems/*</code> tags.</li><li><code>startall.sh</code> / <code>stopall.sh</code>: deploy/remove HPCC (and optional logging/metrics stacks) using Helm.</li></ul><h2 id="examples" tabindex="-1">Examples <a class="header-anchor" href="#examples" aria-label="Permalink to &quot;Examples&quot;">​</a></h2><ul><li><code>examples/numpy/</code>: example of layering extra Python packages on top of <code>platform-core</code> (builds <code>hpccsystems/platform-core:numpy</code>).</li><li><code>examples/ldap/</code>: a <code>docker-compose.yaml</code> that starts a local LDAP server and phpLDAPadmin for development/testing.</li></ul><h2 id="notes-about-ci-files" tabindex="-1">Notes about CI files <a class="header-anchor" href="#notes-about-ci-files" aria-label="Permalink to &quot;Notes about CI files&quot;">​</a></h2><p>This folder also contains <code>action.yml</code> and <code>buildall-common.sh</code>, which are intended for CI publishing workflows. As of this folder’s current contents, <code>action.yml</code> references a <code>Dockerfile</code> next to it, but there is no top-level <code>Dockerfile</code> in this directory. The Dockerfiles in this folder live in subfolders (for example <code>platform-core-ubuntu-22.04/Dockerfile</code> and <code>examples/numpy/addnumpy/Dockerfile</code>). If you intend to use <code>action.yml</code> directly as a Docker Action, verify the expected <code>Dockerfile</code> is present or adjust the action accordingly.</p>`,39)]))}const u=e(n,[["render",t]]);export{k as __pageData,u as default};

import{_ as a,a as t,o as s,ag as r}from"./chunks/framework.Do1Zayaf.js";const p=JSON.parse('{"title":"HPCC Azure storage with a Storage Account","description":"","frontmatter":{},"headers":[],"relativePath":"helm/examples/azure/sa/README.md","filePath":"helm/examples/azure/sa/README.md","lastUpdated":1771585025000}'),o={name:"helm/examples/azure/sa/README.md"};function n(i,e,l,c,h,u){return s(),t("div",null,e[0]||(e[0]=[r('<h1 id="hpcc-azure-storage-with-a-storage-account" tabindex="-1">HPCC Azure storage with a Storage Account <a class="header-anchor" href="#hpcc-azure-storage-with-a-storage-account" aria-label="Permalink to &quot;HPCC Azure storage with a Storage Account&quot;">​</a></h1><h2 id="directory-contents" tabindex="-1">Directory contents <a class="header-anchor" href="#directory-contents" aria-label="Permalink to &quot;Directory contents&quot;">​</a></h2><h3 id="introduction" tabindex="-1">Introduction <a class="header-anchor" href="#introduction" aria-label="Permalink to &quot;Introduction&quot;">​</a></h3><p>Persistent storage can be created manually or through Kubernetes Clusters. If created through Kubernetes the storage will be gone when the Persistent Volume (PV) or Kubernetes clusters are deleted. For Azure a manually created shared storage with a storage account will not depend on any Kubernetes cluster. The data generated will be persistent and re-used as long the PV/PVC names and mount points are the same.</p><h3 id="create-a-share-with-a-storage-account" tabindex="-1">Create a share with a storage account <a class="header-anchor" href="#create-a-share-with-a-storage-account" aria-label="Permalink to &quot;Create a share with a storage account&quot;">​</a></h3><p>To create a shared storage including storage account you can reference <a href="https://docs.microsoft.com/en-us/azure/aks/azure-files-volume" target="_blank" rel="noreferrer">https://docs.microsoft.com/en-us/azure/aks/azure-files-volume</a>. The scripts in this directory (sa/) will help you create an Azure storage account if you don&#39;t already have one. Once you have created a storage account or already have one and a secret, the storage account name, share name, and Kubernetes secret can be set when installing the hpcc-azurefile helm chart.</p><p>Before you run any script make sure to login to Azure first:</p><div class="language-console vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">console</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">az login</span></span></code></pre></div><p>Also you need create a Kubernetes cluster in Azure. The Resource Group name, region (SA_LOCATION) storage account name, and subscription should be set in env-sa file.</p><h3 id="environment-variables" tabindex="-1">Environment variables <a class="header-anchor" href="#environment-variables" aria-label="Permalink to &quot;Environment variables&quot;">​</a></h3><p>env-sa defines some variables for creating a storage account and shared storage. Some variables have default values but some of them don&#39;t and you must provide the values:</p><ul><li>SUBSCRIPTION: Azure subscription</li><li>STORAGE_ACCOUNT_NAME: Storage Account name which will be generated</li><li>SA_RESOURCE_GROUP: a resource group name which must be unique in your subscription</li><li>SA_LOCATION: the region the storage account will be created in. It is recommended to use the same region as the Kubernetes cluster.</li></ul><p>hpcc-azurefile/values.yaml defines three variables needed for storage account and shared storage creation:</p><ul><li>secretName: a Kuberentes secret</li><li>secretNamespace: the namespace of the Kubernetes secret</li><li>shareName: shared storage name which will be used to create the storage. This is defined for each desired plane. If shareName is not specified the plane will use a dynamic azurefile. It is OK to use the same shareName for different planes. For example &quot;dropzone&quot; plane can use the same shareName as &quot;data&quot; plane. Above values can also be provided using the &quot;--set&quot; parameter when running &quot;helm install&quot; but then these values must be set in env-sa for storage account related processes.</li></ul><h3 id="create" tabindex="-1">Create <a class="header-anchor" href="#create" aria-label="Permalink to &quot;Create&quot;">​</a></h3><p>create-sa.sh will source env-sa, create a storage account and shared storage. It will also save the storage key to $SA_KEY_DIR/</p><div class="language-console vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">console</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">./create-sa.sh</span></span></code></pre></div><h3 id="list" tabindex="-1">List <a class="header-anchor" href="#list" aria-label="Permalink to &quot;List&quot;">​</a></h3><p>list-sa.sh will list the shared storage</p><div class="language-console vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">console</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">./list-sa.sh</span></span></code></pre></div><h3 id="create-a-kubernetes-secret" tabindex="-1">Create a Kubernetes secret <a class="header-anchor" href="#create-a-kubernetes-secret" aria-label="Permalink to &quot;Create a Kubernetes secret&quot;">​</a></h3><p>A kubernetes secret is required to use the storage. The secret name, secretName, is defined in hpcc-azurefile/values.yaml.<br> If this Kuberenetes cluster has never generated the secret before, run following to generate the secret</p><div class="language-console vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">console</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">./create-secret.sh</span></span></code></pre></div><p>../hpcc-azurefile helm chart should be started before installing the HPCC helm chart. Reference <a href="./../README.html">parent README.md</a> for the details.</p><h3 id="delete-the-storage" tabindex="-1">Delete the storage <a class="header-anchor" href="#delete-the-storage" aria-label="Permalink to &quot;Delete the storage&quot;">​</a></h3><p>delete-sa.sh will delete the resoruce group which will clean all resources underneath</p><div class="language-console vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">console</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">./delete-sa.sh</span></span></code></pre></div><p>You must make certain the contents of the shared storage are no longer needed since when it is deleted you can&#39;t get it back. On the other hand, be aware the storage will persist even when the kubernetes cluster is destroyed and there are fees/charges for the Azure storage. Be very cautious before making this decision.</p>',28)]))}const g=a(o,[["render",n]]);export{p as __pageData,g as default};

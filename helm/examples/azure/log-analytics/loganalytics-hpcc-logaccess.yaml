# Configures HPCC logAccess to target Azure Log Analytics Workspace
global:
  logAccess:
    name: "Azure LogAnalytics LogAccess"
    type: "AzureLogAnalyticsCurl"
    #connection:
      #All connection attributes are optional.
      #It is preferable to provide connection values as secret values category 'esp', secret name 'azure_logaccess'
      # NOTE: secret 'azure_logaccess' must include 'aad-client-secret' and it cannot be provided in configuration
      #
      #workspaceID: "XYZ"      #ID of the Azure LogAnalytics workspace to query logs from
                               # Secret value equivalent: 'ala-workspace-id'
      #clientID: "DEF"         #ID of Azure Active Directory registered application with api.loganalytics.io access - format: 00000000-0000-0000-0000-000000000000
                               # Secret value equivalent: 'aad-client-id'
      #tenantID: "ABC"         #The Azure Active Directory Tenant ID, required for KQL API access
                               # Secret value equivalent: 'aad-tenant-id'
    logMaps:
    - type: "global"
      storeName: "ContainerLog"
      searchColumn: "LogEntry"
      timeStampColumn: "hpcc_log_timestamp"
      columnMode: "ALL"
    - type: "workunits"
      storeName: "ContainerLog"
      searchColumn: "hpcc_log_jobid"
      columnMode: "DEFAULT"
    - type: "components"
      storeName: "ContainerInventory"
      searchColumn: "Name"
      keyColumn: "ContainerID"
      columnMode: "MIN"
    - type: "audience"
      searchColumn: "hpcc_log_audience"
      EnumValues:
      - Code: OPR
        Label: Operator
      - Code: USR
        Label: User
      - Code: PRO
        Label: Programmer
      - Code: ADT
        Label: Audit
      columnMode: "DEFAULT"
    - type: "class"
      searchColumn: "hpcc_log_class"
      EnumValues:
      - Code: DIS
        Label: Disaster
      - Code: ERR
        Label: Error
      - Code: WRN
        Label: Warning
      - Code: INF
        Label: Information
      - Code: PRO
        Label: Progress
      - Code: MET
        Label: Metric
      columnMode: "DEFAULT"
    - type: "instance"
      storeName: "ContainerInventory"
      searchColumn: "Name"
      projectName: "hpcc_log_component"
      columnMode: "ALL"
    - type: "node"
      columnMode: "DEFAULT"
      searchColumn: "Computer"
      columnMode: "ALL"
    - type: "message"
      searchColumn: "hpcc_log_message"
      columnMode: "MIN"
    - type: "logid"
      searchColumn: "hpcc_log_sequence"
      columnMode: "DEFAULT"
    - type: "processid"
      searchColumn: "hpcc_log_procid"
      columnMode: "ALL"
    - type: "threadid"
      searchColumn: "hpcc_log_threadid"
      columnMode: "DEFAULT"
    - type: "timestamp"
      searchColumn: "hpcc_log_timestamp"
      columnMode: "MIN"
secrets:
  esp:
    azure-logaccess: "azure-logaccess"
vaults:
  esp:
  - name: my-azure-logaccess-vault
    url: http://${env.VAULT_SERVICE_HOST}:${env.VAULT_SERVICE_PORT}/v1/secret/data/esp/${secret}
    kind: kv-v2

if ("${VCPKG_DONE}" STREQUAL "")
  set (VCPKG_DONE 1)

set(VCPKG_FILES_DIR "${CMAKE_BINARY_DIR}" CACHE STRING "Folder for vcpkg download, build and installed files")
set(CMAKE_TOOLCHAIN_FILE ${HPCC_SOURCE_DIR}/vcpkg/scripts/buildsystems/vcpkg.cmake)
set(VCPKG_ROOT ${HPCC_SOURCE_DIR}/vcpkg)
set(VCPKG_INSTALLED_DIR "${VCPKG_FILES_DIR}/vcpkg_installed")
set(VCPKG_INSTALL_OPTIONS "--x-abi-tools-use-exact-versions;--downloads-root=${VCPKG_FILES_DIR}/vcpkg_downloads;--x-buildtrees-root=${VCPKG_FILES_DIR}/vcpkg_buildtrees;--x-packages-root=${VCPKG_FILES_DIR}/vcpkg_packages")

if(WIN32)
    set(VCPKG_HOST_TRIPLET "x64-windows" CACHE STRING "host triplet")
    set(VCPKG_TARGET_TRIPLET "x64-windows" CACHE STRING "target triplet")
elseif(APPLE)
  if (CMAKE_OSX_ARCHITECTURES MATCHES "arm64")
    set(VCPKG_HOST_TRIPLET "arm64-osx" CACHE STRING "host triplet")
    set(VCPKG_TARGET_TRIPLET "arm64-osx" CACHE STRING "target triplet")
  else()
    set(VCPKG_HOST_TRIPLET "x64-osx" CACHE STRING "host triplet")
    set(VCPKG_TARGET_TRIPLET "x64-osx" CACHE STRING "target triplet")
  endif()
elseif(UNIX)
    set(VCPKG_HOST_TRIPLET "x64-linux-dynamic" CACHE STRING "host triplet")
    set(VCPKG_TARGET_TRIPLET "x64-linux-dynamic" CACHE STRING "target triplet")
endif()

message("-- vcpkg settings:")
message("---- VCPKG_FILES_DIR: ${VCPKG_FILES_DIR}")
message("---- CMAKE_TOOLCHAIN_FILE: ${CMAKE_TOOLCHAIN_FILE}")
message("---- VCPKG_ROOT: ${VCPKG_ROOT}")
message("---- VCPKG_INSTALLED_DIR: ${VCPKG_INSTALLED_DIR}")
message("---- VCPKG_INSTALL_OPTIONS: ${VCPKG_INSTALL_OPTIONS}")
message("---- VCPKG_HOST_TRIPLET: ${VCPKG_HOST_TRIPLET}")
message("---- VCPKG_TARGET_TRIPLET: ${VCPKG_TARGET_TRIPLET}")

#  Create a catalog of the vcpkg dependencies ---
file(GLOB VCPKG_PACKAGES ${VCPKG_FILES_DIR}/vcpkg_packages/*/CONTROL)
list(APPEND VCPKG_PACKAGE_LIST "-----------------\n")
foreach(VCPKG_PACKAGE ${VCPKG_PACKAGES})
    file(READ ${VCPKG_PACKAGE} VCPKG_PACKAGE_CONTENTS)
    list(APPEND VCPKG_PACKAGE_LIST ${VCPKG_PACKAGE_CONTENTS})
    list(APPEND VCPKG_PACKAGE_LIST "-----------------\n")
endforeach()
file(WRITE ${CMAKE_BINARY_DIR}/vcpkg-catalog.txt ${VCPKG_PACKAGE_LIST})
if (INSTALL_VCPKG_CATALOG)
    install(FILES ${CMAKE_BINARY_DIR}/vcpkg-catalog.txt DESTINATION "." COMPONENT Runtime)
endif()

endif ()

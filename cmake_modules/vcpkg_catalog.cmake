###############################################################################
#    HPCC SYSTEMS software Copyright (C) 2023 HPCC SystemsÂ®.
#
#    Licensed under the Apache License, Version 2.0 (the "License");
#    you may not use this file except in compliance with the License.
#    You may obtain a copy of the License at
#
#       http://www.apache.org/licenses/LICENSE-2.0
#
#    Unless required by applicable law or agreed to in writing, software
#    distributed under the License is distributed on an "AS IS" BASIS,
#    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
#    See the License for the specific language governing permissions and
#    limitations under the License.
################################################################################

#  Create a catalog of the vcpkg dependencies ---
file(GLOB VCPKG_PACKAGES ${VCPKG_FILES_DIR}/vcpkg_packages/*/CONTROL)
list(APPEND VCPKG_PACKAGE_LIST "-----------------\n")
foreach(VCPKG_PACKAGE ${VCPKG_PACKAGES})
    file(READ ${VCPKG_PACKAGE} VCPKG_PACKAGE_CONTENTS)
    list(APPEND VCPKG_PACKAGE_LIST ${VCPKG_PACKAGE_CONTENTS})
    list(APPEND VCPKG_PACKAGE_LIST "-----------------\n")
endforeach()
# 1. Accept an explicit catalog prefix label; or
# 2. Use the package file name generated by packageSetup.cmake as a prefix; or
# 3. Use the top level project's project name, if set, as a prefix; or
# 4. Use no prefix.
set(VCPKG_CATALOG_NAME "vcpkg-catalog.txt")
if ("${VCPKG_CATALOG_PREFIX}" STREQUAL "")
    set(VCPKG_CATALOG_PREFIX ${PACKAGE_FILE_NAME})
    if ("${VCPKG_CATALOG_PREFIX}" STREQUAL "")
        set(VCPKG_CATALOG_PREFIX ${CMAKE_PROJECT_NAME})
    endif()
endif()
if (NOT "${VCPKG_CATALOG_PREFIX}" STREQUAL "")
    set(VCPKG_CATALOG_NAME "${VCPKG_CATALOG_PREFIX}-${VCPKG_CATALOG_NAME}")
endif()
file(WRITE ${CMAKE_BINARY_DIR}/${VCPKG_CATALOG_NAME} ${VCPKG_PACKAGE_LIST})
if (INSTALL_VCPKG_CATALOG)
    install(FILES ${CMAKE_BINARY_DIR}/${VCPKG_CATALOG_NAME} DESTINATION "." COMPONENT Runtime)
endif()

<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE book PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN"
"http://www.oasis-open.org/docbook/xml/4.5/docbookx.dtd">
<book lang="en_US" xml:base="../">
  <bookinfo>
    <title>HPCC Monitoring and Reporting (Technical Preview)</title>

    <mediaobject>
      <imageobject>
        <imagedata fileref="images/redswooshWithLogo3.jpg" />
      </imageobject>
    </mediaobject>

    <author>
      <surname>Boca Raton Documentation Team</surname>
    </author>

    <legalnotice>
      <para>We welcome your comments and feedback about this document via
      email to <email>docfeedback@hpccsystems.com</email></para>

      <para>Please include <emphasis role="bold">Documentation
      Feedback</emphasis> in the subject line and reference the document name,
      page numbers, and current Version Number in the text of the
      message.</para>

      <para>LexisNexis and the Knowledge Burst logo are registered trademarks
      of Reed Elsevier Properties Inc., used under license.</para>

      <para>HPCC Systems<superscript>®</superscript> is a registered trademark
      of LexisNexis Risk Data Management Inc.</para>

      <para>Other products, logos, and services may be trademarks or
      registered trademarks of their respective companies.</para>

      <para>All names and example data used in this manual are fictitious. Any
      similarity to actual persons, living or dead, is purely
      coincidental.</para>

      <para></para>
    </legalnotice>

    <xi:include href="common/Version.xml" xpointer="FooterInfo"
                xmlns:xi="http://www.w3.org/2001/XInclude" />

    <xi:include href="common/Version.xml" xpointer="DateVer"
                xmlns:xi="http://www.w3.org/2001/XInclude" />

    <corpname>HPCC Systems<superscript>®</superscript></corpname>

    <xi:include href="common/Version.xml" xpointer="Copyright"
                xmlns:xi="http://www.w3.org/2001/XInclude" />

    <mediaobject role="logo">
      <imageobject>
        <imagedata fileref="images/LN_Rightjustified.jpg" />
      </imageobject>
    </mediaobject>
  </bookinfo>

  <chapter id="GangliaIntroduction">
    <title>Introduction</title>

    <para>The HPCC Systems<superscript>®</superscript> platform supports
    graphical monitoring and reporting components.</para>

    <para><emphasis role="bold">Ganglia:</emphasis></para>

    <para>The HPCC monitoring component leverages Ganglia, an open source,
    scalable, distributed monitoring system to display system information in a
    graphical manner.</para>

    <para>With the the graphical monitoring component you can: <itemizedlist>
        <listitem>
          <para>See system information at a glance</para>
        </listitem>

        <listitem>
          <para>View a grid of Roxie clusters</para>
        </listitem>

        <listitem>
          <para>Examine Roxie metrics</para>
        </listitem>

        <listitem>
          <para>Keep a historical record of metrics</para>
        </listitem>

        <listitem>
          <para>Drill down to individual server metrics</para>
        </listitem>

        <listitem>
          <para>Quickly detect troubled nodes</para>
        </listitem>

        <listitem>
          <para>More applications, such as better informed resource planning
          and allocation</para>
        </listitem>
      </itemizedlist></para>

    <para><emphasis role="bold">Nagios</emphasis></para>

    <para>The HPCC reporting and alerting component leverages Nagios, a
    powerful monitoring and notification system, which can help you identify
    and resolve infrastructure problems before they affect critical
    processes.</para>

    <para>With the HPCC reporting and alerting component you can set up alerts
    to inform of any changes to:</para>

    <para><itemizedlist>
        <listitem>
          <para>Disk Usage</para>
        </listitem>

        <listitem>
          <para>Roxie</para>
        </listitem>

        <listitem>
          <para>Dali</para>
        </listitem>

        <listitem>
          <para>Dafilesrv</para>
        </listitem>

        <listitem>
          <para>Sasha</para>
        </listitem>

        <listitem>
          <para>Service Bindings on ESP Servers</para>
        </listitem>

        <listitem>
          <para>SSH connectivity</para>
        </listitem>

        <listitem>
          <para>Users on system</para>
        </listitem>

        <listitem>
          <para>System Load</para>
        </listitem>
      </itemizedlist></para>

    <!--***NOTE: At some point this next bit will need to get moved into the next chapter/section***-->
  </chapter>

  <chapter id="Ganglya_Overview">
    <title>Ganglia</title>

    <para>The HPCC Monitoring component leverages Ganglia, an open source,
    scalable, distributed monitoring system, to produce a graphical view of a
    Roxie cluster's servers. Ganglia leverages widely accepted technologies
    for data representation. It provides near real-time monitoring and
    visualizations for performance metrics. If your enterprise already has a
    Ganglia monitoring server, you can easily add Roxie clusters to its
    monitoring.</para>

    <sect1 id="Ganglia_Overview">
      <title>Ganglia Overview</title>

      <para>Ganglia Monitoring has two primary components: the viewer and the
      Ganglia Monitoring Daemon (gmond). Installation and configuration will
      vary depending on your system.</para>

      <para>On an <emphasis role="bold">RPM-based system</emphasis>, install
      the <emphasis>ganglia-gmond-modules-python</emphasis> RPM running a
      command such as:</para>

      <programlisting>sudo rpm -i ganglia-gmond-modules-python-3.4.0-1.x86_64.rpm</programlisting>

      <para>On a <emphasis role="bold">Debian-based system</emphasis>, install
      the <emphasis>ganglia-monitor</emphasis> running a command such
      as:</para>

      <programlisting>sudo apt-get install ganglia-monitor</programlisting>

      <para>The specific steps required to install and configure Ganglia are
      covered in the Ganglia wiki:</para>

      <para><ulink
      url="http://sourceforge.net/apps/trac/ganglia/wiki/ganglia_gmond_python_modules">http://sourceforge.net/apps/trac/ganglia/wiki/ganglia_gmond_python_modules</ulink></para>

      <sect2>
        <title>Requirements</title>

        <para>In order to use Ganglia with Roxie you must have the following
        packages installed on every node you wish to monitor.</para>

        <itemizedlist>
          <listitem>
            <para>ganglia-gmond</para>
          </listitem>

          <listitem>
            <para>ganglia-gmond-python</para>
          </listitem>

          <listitem>
            <para>python-lxml</para>
          </listitem>
        </itemizedlist>

        <para>For the visualization component you must have:</para>

        <para><itemizedlist>
            <listitem>
              <para>ganglia-gmetad</para>
            </listitem>
          </itemizedlist>Proper installation and operations of the Ganglia
        component depends on these components.</para>
      </sect2>

      <sect2 id="Ganglia_Monitoring_Daemon" role="brk">
        <title>Ganglia Monitoring Daemon</title>

        <para>The monitoring daemon is required on the Roxie nodes you wish to
        monitor. Install the <emphasis>gmond</emphasis> daemon on the nodes
        you wish to monitor. Installation and configuration are described
        in;</para>

        <para><ulink
        url="http://sourceforge.net/apps/trac/ganglia/wiki/ganglia_gmond_python_modules">http://sourceforge.net/apps/trac/ganglia/wiki/ganglia_gmond_python_modules</ulink></para>

        <para>If you have a Ganglia monitoring server running in your
        environment, you already have the required components and
        prerequisites. Verify that you have
        <emphasis>/etc/ganglia/conf.d</emphasis> and
        <emphasis>/etc/ganglia/.pyconf</emphasis> files in place and then add
        the Roxie nodes you wish to monitor. You can do that by installing the
        Ganglia components and HPCC Monitoring components on to each Roxie
        node.</para>

        <para>If you do not have Ganglia, or want to install it, read the
        Ganglia documentation provided at the above link, and install it and
        any system dependencies. You will then need to download and install
        the HPCC Monitoring component.</para>

        <sect3 id="Installing-HPCCGanglia" role="brk">
          <title>Installing the HPCC Monitoring component</title>

          <para>The HPCC Monitoring component is available for download. The
          HPCC Monitoring components leverage the Ganglia monitoring tools,
          and would only be needed if you do not already have Ganglia
          monitoring components on your system.</para>

          <para>To get the HPCC Monitoring components, find the appropriate
          package for your system.</para>

          <para>Packages are available for download from the HPCC
          Systems<superscript>®</superscript> site:</para>

          <para><ulink
          url="http://hpccsystems.com/download">hpccsystems.com/download</ulink></para>

          <para>or</para>

          <para><ulink
          url="http://hpccsystems.com/download/free-community-edition/all">http://hpccsystems.com/download/free-community-edition/all</ulink></para>

          <para>Find and install the appropriate package for your
          system.</para>

          <para>For example, if you have a CentOS 6.x system, get the RPM
          package.</para>

          <programlisting>hpccsystems-ganglia-monitoring-4.2.0-rc1.el6.x86_64.rpm</programlisting>

          <para>Install the monitoring package on the system that you want to
          monitor. Optionally, you can look at that installation package
          provided and use that as a guide to implement your own customized
          monitoring components.</para>
        </sect3>
      </sect2>
    </sect1>

    <sect1 id="HPCC_Viewer">
      <title>The HPCC Ganglia Viewer</title>

      <para>A Ganglia viewer comes preinstalled and configured in the 4.2.x
      (or later) HPCC Virtual Machine. The monitoring provided with the
      Virtual Machine is set up to monitor Roxie instances on the network.
      This document introduces the monitoring and describes how to get it
      working on your system. <figure>
          <title>HPCC Monitoring</title>

          <mediaobject>
            <imageobject>
              <imagedata fileref="images/GAN001.jpg" vendor="Ganglia" />
            </imageobject>
          </mediaobject>
        </figure></para>

      <para>The above image is an overview summary of all the monitored Roxie
      nodes in the cluster named VM Demo.</para>

      <sect2 id="Ganglia_Viewer">
        <title>The Viewer</title>

        <para>If you already have a Ganglia monitoring server running in your
        network, the viewer component may already be in place. If you do not
        have Ganglia then you will need to install and configure the
        viewer.</para>

        <para>Refer to the <ulink
        url="https://github.com/hpcc-systems/ganglia-monitoring/tree/master/vm_precise">https://github.com/hpcc-systems/ganglia-monitoring/tree/master/vm_precise</ulink>
        directory. There you will see the resources used to configure the
        Ganglia for the virtual machine and can use them as the examples to
        configure it for your enterprise.</para>

        <para>The script, <emphasis>install_graphs_helper.sh</emphasis>
        available from the github link above and also provided with the
        virtual machine, is what is used to embed the viewer component. Using
        this script as a basis, you can then similarly configure and deploy
        the viewer component for your system.</para>
      </sect2>
    </sect1>

    <sect1 id="VirtuaLMetrics">
      <title>Metrics in the Virtual Machine</title>

      <para>An easy way to understand how the metrics work and how to
      implement them on a larger system, is to examine the metrics in
      action.</para>

      <para>Ganglia integration is built into the current HPCC Virtual Machine
      images. Download and start up a virtual image and look at how the
      monitoring component works.</para>

      <para>This allows you:</para>

      <itemizedlist>
        <listitem>
          <para>A preview of the metrics</para>
        </listitem>

        <listitem>
          <para>A quickstart</para>
        </listitem>

        <listitem>
          <para>A guide for set up</para>
        </listitem>
      </itemizedlist>

      <para>Evaluate the value of the content and decide what aspects of
      measurement are relevant to your needs.</para>

      <!--INCLUDE-VM_STEPS-as-Sect2-->

      <!--H11780-->

      <xi:include href="HPCCMonitoring/MonRep-Mods/MonRep-VM.xml"
                  xmlns:xi="http://www.w3.org/2001/XInclude" />
    </sect1>

    <sect1 id="GangliaIntegration">
      <title>Ganglia Integration with HPCC</title>

      <para>The Roxie nodes are able to report metrics to Ganglia when the
      nodes have Ganglia monitoring and the associated dependencies
      installed.</para>

      <para>Review the Ganglia wiki: <ulink
      url="http://sourceforge.net/apps/trac/ganglia/wiki/ganglia_gmond_python_modules">http://sourceforge.net/apps/trac/ganglia/wiki/ganglia_gmond_python_modules</ulink>
      to understand the requirements.</para>

      <orderedlist>
        <listitem>
          <para>Install the Ganglia components on every node.</para>
        </listitem>

        <listitem>
          <para>Configure the Ganglia as appropriate for your system</para>

          <para>The Ganglia configuration files can be typically found in the
          <emphasis>/etc/ganglia/</emphasis> directory.</para>
        </listitem>

        <listitem>
          <para>Install the HPCC Systems<superscript>®</superscript>
          monitoring component on every node.</para>
        </listitem>

        <listitem>
          <para>Deploy the monitoring daemon (gmond) and the HPCC Monitoring
          package to each of the nodes you wish to monitor.</para>
        </listitem>
      </orderedlist>

      <para>The VM graphs can be used to monitor Roxie clusters. You can add
      more Roxie nodes installed anywhere on the same network utilizing
      multi-cast.</para>

      <para>To add a new Roxie node, install the HPCC Monitoring package on to
      each Roxie node to monitor. In most basic configurations you may need to
      add the node(s) IP address(es) to the
      <emphasis>/etc/ganglia/gmetad.conf</emphasis> file. As long as the new
      Roxie node can communicate with (for example ping) the Monitoring
      component host, the graphs for that will automatically be added to the
      graph display.</para>

      <para><variablelist>
          <varlistentry>
            <term>NOTE:</term>

            <listitem>
              <para>Some of the graphs take some time to populate with data.
              These graphs may appear blank or empty at first, but will render
              properly as more data accumulates to populate the graph.</para>
            </listitem>
          </varlistentry>
        </variablelist></para>
    </sect1>

    <sect1>
      <title>Ganglia in ECL Watch</title>

      <para>With the Ganglia for HPCC Plug-in installed. You can view the
      Ganglia statistics and graphs right through the ECL Watch interface. The
      out of the box monitoring displays several key statistics by default.
      You can customize and configure the views.</para>

      <figure>
        <title>Ganglia in ECL Watch</title>

        <mediaobject>
          <imageobject>
            <imagedata fileref="images/GAN051.jpg" vendor="VM_welcome" />
          </imageobject>
        </mediaobject>
      </figure>

      <para>The default Plug-ins page has a tab for Custom Monitoring where
      you can easily add some custom monitoring components.</para>

      <para>Select the Custom Monitoring tab, and press the Metrics button.
      Use the drop menus to display the various graphing utilities.</para>

      <sect2>
        <title>Installing Ganglia in ECL Watch</title>

        <para>In order to get the Ganglia in ECL Watch, You need to have
        Ganglia on your HPCC Systems. <orderedlist>
            <listitem>
              <para>Install or ensure you have the HPCC Monitoring components
              on a node where ECL Watch is installed.</para>
            </listitem>

            <listitem>
              <para>Ensure that the Ganglia gtemad daemon is running.</para>
            </listitem>

            <listitem>
              <para>Restart the ESP if this is the initial installation of any
              of those components.</para>
            </listitem>

            <listitem>
              <para>Start or connect to ECL Watch on that node.</para>
            </listitem>

            <listitem>
              <para>Click the plug-in icon at the top of the ECL Watch
              page.</para>

              <para>The graphs display data.</para>
            </listitem>
          </orderedlist></para>

        <para>It is also possible for EclWatch/Esp to be on a separate,
        different node from the gmetad machine, as long as the rrd data
        directories are exposed to the plug-in.</para>
      </sect2>

      <sect2>
        <title>Configuring Ganglia graphs in ECL Watch</title>

        <para>The configuration of Ganglia in ECL Watch is maintained in the
        <emphasis role="bold">ganglia.json</emphasis> file. That can be found
        in the HPCC Systems<superscript>®</superscript> system
        directory/componentfiles. The default HPCC
        Systems<superscript>®</superscript> system directory ganglia resources
        is:</para>

        <para>/opt/HPCCSystems/componentfiles/files/ganglia</para>

        <para>The configuration can be customized and modified to suit your
        specific needs.</para>
      </sect2>
    </sect1>
  </chapter>

  <chapter>
    <title>Nagios</title>

    <para>The HPCC Reporting component leverages Nagios, an open source,
    system and network infrastructure monitoring application to monitor and
    alert HPCC Administrators. Nagios leverages established and accepted open
    source technologies to alert users to changes or potential issues. Nagios
    provides regular periodic system monitoring and reporting.</para>

    <para>With the HPCC integration, you can generate Nagios configuration
    files to monitor HPCC server health. Once the Nagios is configured, you
    can monitor:<itemizedlist>
        <listitem>
          <para>Disk Usage</para>
        </listitem>

        <listitem>
          <para>Roxie</para>
        </listitem>

        <listitem>
          <para>Dali</para>
        </listitem>

        <listitem>
          <para>Dafilesrv</para>
        </listitem>

        <listitem>
          <para>Sasha</para>
        </listitem>

        <listitem>
          <para>Service Bindings on ESP Servers</para>
        </listitem>
      </itemizedlist></para>

    <para>With additional available (3rd party) plug-ins, check utilities, and
    modification of the config file, Nagios can also monitor:</para>

    <para><itemizedlist>
        <listitem>
          <para>SSH connectivity</para>
        </listitem>

        <listitem>
          <para>Users on system</para>
        </listitem>

        <listitem>
          <para>System load</para>
        </listitem>

        <listitem>
          <para>Disk / CPU / Memory usage</para>
        </listitem>

        <listitem>
          <para>Network infrastructure</para>
        </listitem>

        <listitem>
          <para>More...</para>
        </listitem>
      </itemizedlist></para>

    <sect1 id="NagiosIntro">
      <title>Nagios Introduction</title>

      <para>Nagios is a powerful monitoring and notification system, which can
      be used with HPCC to help identify and resolve infrastructure problems
      before they affect critical processes. Nagios hardware notifications can
      help keep your system highly available and alerts can assist in
      pre-emptive maintenance for processes which are down or behaving outside
      expected parameters to ensure system stability, reliability, and uptime.
      Scripts and tools are provided to extract HPCC Platform system metrics
      and easily integrate that data into Nagios.</para>

      <para>Administrators should note that different platforms may not
      support all plug-ins. The <emphasis>hpcc-nagios-tools</emphasis> utility
      can be used to simplify the addition of custom plug-ins. Many additional
      Nagios plug-ins and utilities are available from 3rd parties.</para>

      <para>The Nagios package is not simply an "install and run" utility, it
      requires additional steps to configure and use properly. If you are not
      already familiar with Nagios, then you should:<itemizedlist>
          <listitem>
            <para>Familiarize yourself with the base Nagios package from
            https://www.nagios.org</para>
          </listitem>

          <listitem>
            <para>Set up a base Nagios installation, such as one on a virtual
            machine.</para>
          </listitem>

          <listitem>
            <para>Review our HPCC Monitoring and Reporting documentation in
            its entirety.</para>
          </listitem>

          <listitem>
            <para>Review our VM installation and configuration.</para>
          </listitem>
        </itemizedlist></para>

      <para>Nagios sets thresholds to trigger alerts. A check may indicate a
      failure or high load that caused a timeout, so some historical baseline
      would be helpful. Ganglia maybe useful for that purpose. Nagios
      monitoring uses a polling interval to check system health. Frequency and
      number of checks would depend on the needs in the cluster. Alerts are
      only useful if they are actionable. Consider who gets alerted (tiered
      escalations), when they get alerted (thresholds, multiple), and what
      types of alerts (none?, email, text, phone, EclWatch etc…) before
      configuring your environment.</para>
    </sect1>

    <sect1 id="NagiosVM">
      <title>Nagios in the Virtual Machine</title>

      <para>An easy way to understand how the Nagios works and how to
      implement it on a larger system, is to examine an established session in
      action.</para>

      <para>Nagios integration is built into the current HPCC Virtual Machine
      images. Download and start up a virtual image and look at how the
      monitoring component works.</para>

      <para>The Nagios component for HPCC on the VM allows you:</para>

      <itemizedlist>
        <listitem>
          <para>A preview of the alerts</para>
        </listitem>

        <listitem>
          <para>A quickstart</para>
        </listitem>

        <listitem>
          <para>A guide for set up</para>
        </listitem>
      </itemizedlist>

      <para>Evaluate the value of the content and decide what aspects are
      relevant to your needs.</para>

      <!--INCLUDE-VM_STEPS-as-Sect2-->

      <sect2 id="hpcc-2id">
        <xi:include href="HPCCMonitoring/MonRep-Mods/MonRep-VM.xml"
                    xpointer="xpointer(/sect2/node())"
                    xmlns:xi="http://www.w3.org/2001/XInclude" />
      </sect2>

      <sect2>
        <title>Nagios Interface</title>

        <para>There are a number of Nagios configurations available. To get a
        better understanding of Nagios configuration, look at the
        configuration delivered with the VM. To login to the Nagios admin
        page:</para>

        <orderedlist>
          <listitem>
            <para>Go to
            <emphasis>http://nnn.nnn.nnn.nnn/</emphasis>nagios3</para>

            <para>Where the <emphasis>nnn.nnn.nnn.nnn</emphasis> is your ESP
            server running ECL Watch.</para>
          </listitem>

          <listitem>
            <para>Login with username : nagiosadmin</para>
          </listitem>

          <listitem>
            <para>Enter the password : nagiosadmin</para>
          </listitem>
        </orderedlist>

        <para>Once logged in the Nagios landing page displays. This page
        displays information about Nagios and contains links to the various
        components, items, and documentation.</para>

        <para>To view the configuration, click on the <emphasis
        role="bold">Host Groups</emphasis> link from the Nagios navigation
        menu on the left side of the page.</para>

        <para><figure>
            <title>Nagios Host Groups</title>

            <mediaobject>
              <imageobject>
                <imagedata fileref="images/NAG001.jpg" />
              </imageobject>
            </mediaobject>
          </figure></para>

        <para>This displays the Host Groups being monitored.</para>

        <figure>
          <title>Nagios Host Groups</title>

          <mediaobject>
            <imageobject>
              <imagedata fileref="images/NAG002.jpg" />
            </imageobject>
          </mediaobject>
        </figure>

        <sect3>
          <title>Nagios Services</title>

          <para>Click on the <emphasis role="bold">Services</emphasis> link
          from the Nagios navigation menu on the left side of the page.
          <figure>
              <title>Nagios Services</title>

              <mediaobject>
                <imageobject>
                  <imagedata fileref="images/NAG003.jpg" />
                </imageobject>
              </mediaobject>
            </figure></para>

          <para>The services link displays the Service Status details for the
          systems being monitored. <figure>
              <title>Nagios Service status</title>

              <mediaobject>
                <imageobject>
                  <imagedata fileref="images/NAG004.jpg" />
                </imageobject>
              </mediaobject>
            </figure></para>

          <para>You can see the service status for the systems being
          monitored.</para>
        </sect3>
      </sect2>
    </sect1>

    <sect1>
      <title>Installation of Nagios</title>

      <para>The HPCC Nagios package provides tools and utilities for
      generating Nagios configurations. These configurations check HPCC and
      perform some of the HPCC specific checks. HPCC Nagios installation is
      provided on the HPCC Systems<superscript>®</superscript> portal.</para>

      <sect2 id="HPCC_Nagios_Installation">
        <title>HPCC Nagios Installation Package</title>

        <para>To get the HPCC Nagios monitoring on your system you need the
        Installation package. Download the installation package from the HPCC
        Systems portal.</para>

        <para>The HPCC Systems<superscript>®</superscript> web portal is where
        you can find HPCC resources, downloads, plug-ins, as well as helpful
        information.</para>

        <para><ulink
        url="http://hpccsystems.com/download/free-community-edition/monitoring">http://hpccsystems.com/</ulink></para>

        <para>You can find the HPCC Monitoring and Reporting Installation
        packages at:</para>

        <para><ulink
        url="http://hpccsystems.com/download/free-community-edition/monitoring">http://hpccsystems.com/download/free-community-edition/monitoring</ulink></para>

        <para>Download the appropriate installation package for your operating
        system.</para>
      </sect2>

      <sect2 role="brk">
        <title>Install Nagios</title>

        <para>To Install Nagios for HPCC, you must have HPCC System platform
        installed and also have the open-source Nagios package
        installed.</para>

        <para><orderedlist>
            <listitem>
              <para>Install the <emphasis
              role="bold">hpcc-nagios-monitoring</emphasis> on the node that
              will be doing the monitoring. The node where you install the
              Nagios monitoring must have network connectivity to all the
              monitored nodes.</para>

              <para>With the hpcc-nagios tools installed, you have HPCC check
              utilities in:</para>

              <para><programlisting> /usr/lib/nagios/plugins/ </programlisting></para>
            </listitem>

            <listitem>
              <para>Generate Nagios configuration files. There are several
              configuration options for Nagios. Determine your needs and
              customize accordingly.</para>

              <para>The main features included are tools to generate Nagios
              configurations. The generated configurations can be modified
              with optional flags to fit the environment that is being
              monitored. The default package also provides some utilities to
              monitor HPCC processes such as Roxies, ESP Services by node and
              port, Dali, and dafilesrv. Other processes could also be
              monitored if a check utility is provided and the generated
              config file is modified (find/replace all would probably
              suffice).</para>
            </listitem>
          </orderedlist>Generate a host groups configuration for
        Nagios.</para>

        <programlisting> /opt/HPCCSystem/bin/hpcc-nagios-tools -env   \
 /etc/HPCCSystems/environment.xml -g -out /etc/nagios3/config.d/hpcc_hostgroups.cfg 
</programlisting>

        <para>Generate a services configuration file.</para>

        <programlisting> /opt/HPCCSystem/bin/hpcc-nagios-tools -env   \
 /etc/HPCCSystems/environment.xml -s -out /etc/nagios3/config.d/hpcc_services.cfg
</programlisting>

        <para>Generate an escalation notifications file.</para>

        <para><programlisting>./hpcc-nagios-tools -ec -env /etc/HPCCSystems/environment.xml  \
-enable_host_notify -enable_service_notify -set_url localhost/nagios3 \
-disable_check_all_disks –out /etc/nagios3/conf.d/hpcc_notifications.cfg
</programlisting>The configurations you generate can be used as is, merged
        with existing configurations, or modified to meet your specific
        needs.</para>

        <para><orderedlist continuation="continues">
            <listitem>
              <para>Integrate the host and services configuration files into
              the Nagios configuration folders.</para>
            </listitem>

            <listitem>
              <para>Restart Nagios for the new configuration to take
              effect.</para>
            </listitem>
          </orderedlist></para>

        <sect3>
          <title>Nagios Options</title>

          <para>You may need to override some of the default values, depending
          on your Linux distribution. For different distributions you may need
          to modify some of the check scripts. Use the override flags to
          properly name all the check scripts in the configuration files as
          appropriate for your distribution.</para>

          <para>The thresholds levels are dependent on your specific needs and
          environments. The default values are starting points. Evaluation of
          your specific needs over time will help you determine appropriate
          thresholds for your production environment(s).</para>

          <para>To override the defaults, modify the generated configurations
          as needed.</para>

          <para>Monitoring tools like Ganglia can help to determine what the
          thresholds should be.</para>
        </sect3>

        <sect3 id="nagios-tools_Usage" role="brk">
          <title>hpcc-nagios-tools usage</title>

          <para><emphasis role="bold">hpcc-nagios-tools -env</emphasis>
          <emphasis>&lt;environment file&gt;</emphasis> <emphasis
          role="bold">-out</emphasis> <emphasis>&lt;output path&gt;</emphasis>
          <emphasis role="bold">[</emphasis>options<emphasis
          role="bold">]</emphasis></para>

          <para>Available optional parameters: <informaltable>
              <tgroup cols="3">
                <colspec colwidth="175pt" />

                <colspec colwidth="155pt" />

                <colspec />

                <thead>
                  <row>
                    <entry>Option/Flag</entry>

                    <entry>Detail</entry>

                    <entry>Default Value</entry>
                  </row>
                </thead>

                <tbody>
                  <row>
                    <entry>-c or -cfggen</entry>

                    <entry>The path to the configgen</entry>

                    <entry>/opt/HPCCSystems/sbin/configgen</entry>
                  </row>

                  <row>
                    <entry>-g or -hostgroup</entry>

                    <entry>generate host group file</entry>

                    <entry></entry>
                  </row>

                  <row>
                    <entry>-s or -service</entry>

                    <entry>generate service and host file</entry>

                    <entry></entry>
                  </row>

                  <row>
                    <entry>-n or -nrpe</entry>

                    <entry>generate client plugin cfgs for nrpe</entry>

                    <entry></entry>
                  </row>

                  <row>
                    <entry>-e or -env</entry>

                    <entry>hpcc environment configuration file</entry>

                    <entry>/etc/HPCCSystems/environment.xml</entry>
                  </row>

                  <row>
                    <entry>-ec or -escalation_cmds</entry>

                    <entry>generate escalation commands</entry>

                    <entry></entry>
                  </row>

                  <row>
                    <entry>-enable_host_notify</entry>

                    <entry>enable host notifications</entry>

                    <entry>0</entry>
                  </row>

                  <row>
                    <entry>-enable_service_notify</entry>

                    <entry>enable service notifications</entry>

                    <entry>0</entry>
                  </row>

                  <row>
                    <entry>-set_url</entry>

                    <entry>set the url link for escalation
                    notifications</entry>

                    <entry>NotificationURL</entry>
                  </row>

                  <row>
                    <entry>-override_send_serivce_status</entry>

                    <entry>override send_status escalation command</entry>

                    <entry>/opt/HPCCSystems/bin/send_status -o $HOSTADDRESS$
                    -s $SERVICESTATE$ -d '$SERVICENOTES$' -t $TIMET$ -n
                    $SERVICEDISPLAYNAME$</entry>
                  </row>

                  <row>
                    <entry>-override_send_host_status</entry>

                    <entry>override send_status escalation command</entry>

                    <entry>/opt/HPCCSystems/bin/send_status -o $HOSTADDRESS$
                    -s $HOSTSTATE$ -d '$HOSTNOTES$' -t $TIMET$ -n
                    $HOSTDISPLAYNAME$</entry>
                  </row>

                  <row>
                    <entry>-override_service_status</entry>

                    <entry>override host_notification_commands</entry>

                    <entry>send_service_status</entry>
                  </row>

                  <row>
                    <entry>-override_host_status</entry>

                    <entry>override service_notification_commands</entry>

                    <entry>send_host_status</entry>
                  </row>

                  <row>
                    <entry>-override_eclwatch_host_port</entry>

                    <entry>Override eclwatch host port for escalation
                    commands. This flag may be specified multiple
                    times.</entry>

                    <entry></entry>
                  </row>

                  <row>
                    <entry>-o or -output</entry>

                    <entry>outpfile where the generated configuration will be
                    written</entry>

                    <entry></entry>
                  </row>

                  <row>
                    <entry>-r or -retry</entry>

                    <entry>keep attempting to resolve IP to hostnames. Stops
                    after 1st failure.</entry>

                    <entry></entry>
                  </row>

                  <row>
                    <entry>-u or -user</entry>

                    <entry>MACRO name to use for username for esp server
                    login. Example: $USER1$</entry>

                    <entry></entry>
                  </row>

                  <row>
                    <entry>-p or -pass</entry>

                    <entry>MACRO to use for password for esp server login.
                    Example: $USER2$</entry>

                    <entry></entry>
                  </row>

                  <row>
                    <entry>-attempts</entry>

                    <entry>max host retry attempts</entry>

                    <entry>10</entry>
                  </row>

                  <row>
                    <entry>-sysload1warn</entry>

                    <entry>load1 warning threshold</entry>

                    <entry>5</entry>
                  </row>

                  <row>
                    <entry>-sysload5warn</entry>

                    <entry>load5 warning threshold</entry>

                    <entry>4</entry>
                  </row>

                  <row>
                    <entry>-sysload15warn</entry>

                    <entry>load15 warning threshold</entry>

                    <entry>3</entry>
                  </row>

                  <row>
                    <entry>-sysload1crit</entry>

                    <entry>load1 critical threshold</entry>

                    <entry>10</entry>
                  </row>

                  <row>
                    <entry>-sysload5crit</entry>

                    <entry>load5 critical threshold</entry>

                    <entry>6</entry>
                  </row>

                  <row>
                    <entry>-sysload15crit</entry>

                    <entry>load15 critical threshold</entry>

                    <entry>4</entry>
                  </row>

                  <row>
                    <entry>-diskspacewarn</entry>

                    <entry>disk space % warning threshold</entry>

                    <entry>15</entry>
                  </row>

                  <row>
                    <entry>-diskspacecrit</entry>

                    <entry>disk space % critical threshold</entry>

                    <entry>8</entry>
                  </row>

                  <row>
                    <entry>-usernumwarn</entry>

                    <entry>users logged in warning threshold</entry>

                    <entry>5</entry>
                  </row>

                  <row>
                    <entry>-usernumcrit</entry>

                    <entry>users logged in critical threshold</entry>

                    <entry>10</entry>
                  </row>

                  <row>
                    <entry>-totalprocswarn</entry>

                    <entry>total process warning threshold</entry>

                    <entry>350</entry>
                  </row>

                  <row>
                    <entry>-totalprocscrit</entry>

                    <entry>total process critical threshold</entry>

                    <entry>500</entry>
                  </row>

                  <row>
                    <entry>-checkperiod</entry>

                    <entry>host check period</entry>

                    <entry>24x7</entry>
                  </row>

                  <row>
                    <entry>-contacts</entry>

                    <entry>host contacts</entry>

                    <entry>eclwatch</entry>
                  </row>

                  <row>
                    <entry>-contactgroups</entry>

                    <entry>host contact groups</entry>

                    <entry>eclwatch_group</entry>
                  </row>

                  <row>
                    <entry>-notify_interval</entry>

                    <entry>host contact groups</entry>

                    <entry>1</entry>
                  </row>

                  <row>
                    <entry>-notify_period</entry>

                    <entry>host contact groups</entry>

                    <entry>24x7</entry>
                  </row>

                  <row>
                    <entry>-override_check_all_disks</entry>

                    <entry>check_all_disk plugin name</entry>

                    <entry>check_all_disks</entry>
                  </row>

                  <row>
                    <entry>-override_check_users</entry>

                    <entry>check_users plugin name</entry>

                    <entry>check_users</entry>
                  </row>

                  <row>
                    <entry>-override_check_procs</entry>

                    <entry>check_procs plugin name</entry>

                    <entry>check_procs</entry>
                  </row>

                  <row>
                    <entry>-override_check_load</entry>

                    <entry>check_load plugin name</entry>

                    <entry>check_load</entry>
                  </row>

                  <row>
                    <entry>-override_retry_interval</entry>

                    <entry>check retry_interval</entry>

                    <entry>1</entry>
                  </row>

                  <row>
                    <entry>-override_active_checks_enabled</entry>

                    <entry>active_checks</entry>

                    <entry>1</entry>
                  </row>

                  <row>
                    <entry>-override_passive_checks_enabled</entry>

                    <entry>passive_checks</entry>

                    <entry>1</entry>
                  </row>

                  <row>
                    <entry>-override_parallelize_check</entry>

                    <entry>parallelize_check</entry>

                    <entry>1</entry>
                  </row>

                  <row>
                    <entry>-override_obsess_over_service</entry>

                    <entry>obsess_over_service</entry>

                    <entry>1</entry>
                  </row>

                  <row>
                    <entry>-override_check_freshness</entry>

                    <entry>check_freshness</entry>

                    <entry>0</entry>
                  </row>

                  <row>
                    <entry>-override_event_handler_enabled</entry>

                    <entry>event_handler_enabled</entry>

                    <entry>1</entry>
                  </row>

                  <row>
                    <entry>-override_is_volatile</entry>

                    <entry>is_volatile</entry>

                    <entry>0</entry>
                  </row>

                  <row>
                    <entry>-override_normal_check_interval</entry>

                    <entry>normal_check_interval</entry>

                    <entry>1</entry>
                  </row>

                  <row>
                    <entry>-override_retry_check_interval</entry>

                    <entry>retry_check_interval</entry>

                    <entry>1</entry>
                  </row>

                  <row>
                    <entry>-override_flap_detection_enabled</entry>

                    <entry>flap_detection_enabled</entry>

                    <entry>1</entry>
                  </row>

                  <row>
                    <entry>-override_process_perf_data</entry>

                    <entry>process_perf_data</entry>

                    <entry>1</entry>
                  </row>

                  <row>
                    <entry>-override_failure_prediction_enabled</entry>

                    <entry>failure_prediction_enabled</entry>

                    <entry>1</entry>
                  </row>

                  <row>
                    <entry>-override_retain_status_information</entry>

                    <entry>retain_status_information</entry>

                    <entry>0</entry>
                  </row>

                  <row>
                    <entry>-override_retain_nonstatus_information</entry>

                    <entry>retain_nonstatus_information</entry>

                    <entry>0</entry>
                  </row>

                  <row>
                    <entry>-disable_check_all_disks</entry>

                    <entry>disable disk space checks</entry>

                    <entry></entry>
                  </row>

                  <row>
                    <entry>-disable_check_users</entry>

                    <entry>disable user logged on checks</entry>

                    <entry></entry>
                  </row>

                  <row>
                    <entry>-disable_check_procs</entry>

                    <entry>disable process checks</entry>

                    <entry></entry>
                  </row>

                  <row>
                    <entry>-disable_check_load</entry>

                    <entry>disable load check</entry>

                    <entry></entry>
                  </row>

                  <row>
                    <entry>-disable_use_of_note_for_host_port</entry>

                    <entry>the send command will use the detail/note for
                    host:ip insteaad of param</entry>

                    <entry>true</entry>
                  </row>

                  <row>
                    <entry>-use_https</entry>

                    <entry>Use https connection for esp service calls.
                    <emphasis role="bold">HIGHLY RECOMMENDED</emphasis> when
                    using username/password</entry>

                    <entry></entry>
                  </row>

                  <row>
                    <entry>-d or -debug</entry>

                    <entry>verbose debug output\n</entry>

                    <entry></entry>
                  </row>
                </tbody>
              </tgroup>
            </informaltable></para>

          <para>Use the available option flags to customize the configuration
          of Nagios as appropriate for your environment.</para>
        </sect3>

        <sect3>
          <title>Help</title>

          <para>For help with HPCC Nagios enter:</para>

          <programlisting> /opt/HPCCSystems/bin/hpcc-nagios-tools</programlisting>

          <para>Entering the command without any parameters or options
          specified displays all the available options.</para>
        </sect3>
      </sect2>
    </sect1>

    <sect1 id="Nagios_in_ECLWatch">
      <title>Nagios in ECL Watch</title>

      <para>ECL Watch is set up for monitoring your system with Nagios. ECL
      Watch has an API that can interface with Nagios and provide Nagios
      monitoring right in ECL Watch. Nagios escalations can be pointed to any
      ECL Watch version 5.4 (and later) and are viewable directly in ECL
      Watch.</para>

      <para>By default all ECL Watch services defined in the environment.xml
      will receive notifications generated using
      <emphasis>hpcc-nagios-tools</emphasis>. You can override that if not
      desired. The ECL Watch instances need not be in the cluster that is
      being monitored. <figure>
          <title>Nagios in ECL Watch</title>

          <mediaobject>
            <imageobject>
              <imagedata fileref="images/NAG010.jpg" vendor="VM_welcome" />
            </imageobject>
          </mediaobject>
        </figure></para>

      <para>Once you have Nagios configured for your environment, you can see
      at a glance if there are any alerts. Along the top banner of the ECL
      Watch window, you will see a small indicator light. The light is darkend
      (gray) if there is no system data being reported, typically indicative
      that your system is not yet configured for monitoring.</para>

      <para>The light is green when all systems are reporting normal. The
      light is yellow when there is warning. The light turns red when there is
      an alert. All the alerts are configurable through the Nagios
      configuration.</para>

      <para>By default ECL Watch monitoring maintains the latest update for 30
      minutes. This means that once Nagios stops escalations to ECL Watch any
      status, including Normal will expire from the list. Nagios escalations
      notification behavior and frequency is configurable, refer to the Nagios
      documentation for more information. An empty list could indicate ‘no
      data’ or ‘no outages’, by default no alerts generate when everything is
      up and running.</para>

      <para>To delve further into any warnings or alerts, you can press the
      indicator light at the top. You can also access the <emphasis>Primary
      Monitoring</emphasis> page by pressing the <emphasis
      role="bold">Operations</emphasis> link, then press the <emphasis
      role="bold">Monitoring</emphasis> link in the navigation sub-menu.
      <figure>
          <title>Nagios in ECL Watch</title>

          <mediaobject>
            <imageobject>
              <imagedata fileref="images/NAG011.jpg" vendor="VM_welcome" />
            </imageobject>
          </mediaobject>
        </figure></para>

      <para>This displays the all the messages and alerts reported to the
      monitoring system. For more information on a specific message, press the
      arrow next to the message you want.</para>
    </sect1>
  </chapter>
</book>
